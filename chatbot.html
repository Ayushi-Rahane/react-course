<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot</title>
    <style>
        body{
            margin-top: 0px;
            margin-bottom: 0px;
        }
        .send-btn{
            background-color: rgb(25, 135, 84);
            color:white;
            border:none;
            padding:8px 16px;
            border-radius:4px;
            cursor:pointer;
            margin-left:8px;
            font-size: 15px;
        }
        .chat-input{
            padding:8px;
            font-size:15px;
            border:2px solid gray;
            border-radius:4px;
            flex-grow: 1;
        }
        .chat-input-div{
            display: flex;
         
        }
        .app-div{
            max-width:500px;
            margin:auto;
            margin-top:50px;
            border:2px solid black;
            padding:16px;
            border-radius:8px;
            box-shadow: 2px 2px 12px rgba(0,0,0,0.2);
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;

        }
        .robot-div, .user-div{
            display: flex;
            align-items: center;
            margin:8px 0;
        }
        .robot-div img, .user-div img{
            border-radius: 50%;
            margin:0 8px;
        }
        .robot-div{
            justify-content: flex-start;
        } 
        .user-div{
            justify-content: flex-end;
        }  
        .chat-msg-div{
            background-color: antiquewhite;
            padding:8px 12px;
            border-radius:16px;
            max-width:70%;
        } 
        .chatbot-img{
            width: 45px;
            height:45px;
        }
        .chat-msgs-div{
            flex-grow: 1;
            overflow: scroll;
            scrollbar-width: none;

            
        }
    </style>
</head>
<body>
    <div class="container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js  "></script>

    <script type="text/babel">
      function ChatInput({setChatMsgs, chatMsgs}){

        const[inputMsg, setInputMsg] = React.useState("");
        function setInputValue(event){
            setInputMsg(event.target.value);
        }
        function sendMsg(){
            const newChatMsgs =[
                ...chatMsgs,
                {
                    msg:inputMsg,
                    sender:"user",
                    id:crypto.randomUUID()
 
                }
            ];
            setChatMsgs(
                newChatMsgs
            );
           const response = Chatbot.getResponse(inputMsg);
         
             setChatMsgs(
                [
                ...newChatMsgs,
                {
                    msg:response,
                    sender:"robot",
                    id:crypto.randomUUID()
 
                }
            ]
          );
            setInputMsg("");
        }
        return(
           <div className="chat-input-div"> {/*React Fragment: won't let us use extra div */}
                <input className="chat-input" 
                    type="text"
                    placeholder="Send a message to Chatbot" 
                    size="40"
                    onChange={setInputValue}
                    value={inputMsg}
                />
                <button className="send-btn" onClick={sendMsg}>Send</button>
           </div>
        );
       }

       function ChatMessage(props){
     //   const msg = props.message;
       // const img_src = props.img_src;

       const {msg} = props;
       const {sender} = props;

    /*. it's shortcut is giving below using guard operator: && 
      if(sender=="robot"){
        return (
             <div>
                <img src="robot.png" 
                alt="chatbot image" width="50" />
                 {msg}
            </div>
        );
       }*/
        return(
            <div className={sender==='robot'?"robot-div":"user-div"}>
                {sender==='robot' && 
                    (
                    <img 
                        src="robot.png" 
                        alt="chatbot image" 
                        className="chatbot-img"
                    />
                    )
                }

                <div className='chat-msg-div'>{msg}</div>

                {sender==='user' && 
                    (   
                        <img 
                            src="user.png" 
                            alt="chatbot image" 
                            className="chatbot-img"
                        />
                    )
                }
            </div>
        );
       }
   function ChatMsgs(props){
       
      const chatMsgRef =  React.useRef(null);
       React.useEffect(() =>{
            const contElement =  chatMsgRef.current;
            if(contElement){
                contElement.scrollTop = contElement.scrollHeight;
            }
       }, [props.chatMsgs]);    
        return(
            <div className="chat-msgs-div" ref={chatMsgRef}>
             
              {props.chatMsgs.map((chatmsg) =>{
                 return(
                    <ChatMessage 
                        msg={chatmsg.msg} 
                        sender={chatmsg.sender}
                        key={chatmsg.id}
                    />
                    )
                })
            }
            </div>
        );
     }
     function App(){
              const [chatMsgs, setChatMsgs] = React.useState(
            [
          
            {
                msg:"hello user!",
                sender:"robot",
                id:'id2'
            }
        ]
        );
     // const [chatMsgs, setChatMsgs] = array;
      // const chatMsgs = array[0];
      // const setChatMsgs = array[1];
       
          return(
             <div className="app-div">
            
              <ChatMsgs 
              chatMsgs={chatMsgs}
              />
                <ChatInput chatMsgs={chatMsgs} setChatMsgs={setChatMsgs}/>
           </div>
          );
     }
      
      const cont = document.querySelector(".container");
      ReactDOM.createRoot(cont).render(<App/>);
    </script>


</body>
</html>